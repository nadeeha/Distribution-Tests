import pandas as pd
import plotly.express as px
from ipywidgets import interact

# Sample DataFrame
data = {
    'company_name': ['Company A', 'Company B', 'Company C', 'Company D', 'Company E'],
    'year': [2021, 2021, 2022, 2022, 2023],
    'green_share_revenue_%': [5, 12, 8, 20, 3]  # Already in 0-100% scale
}

df_plot = pd.DataFrame(data)

# Define bins
bins = list(range(0, 101, 5))  # 0-5, 5-10, ..., 95-100

# Add bin column to the DataFrame
df_plot['bins'] = pd.cut(df_plot['green_share_revenue_%'], bins=bins, right=False).apply(lambda x: int(x.left))

# Function to plot the histogram based on the selected year
def plot_histogram(selected_year):
    # Filter data for the selected year
    filtered_df = df_plot[df_plot['year'] == selected_year]

    # Create the histogram
    fig = px.histogram(
        filtered_df,
        x='bins',
        title=f'Green Revenue Share for {selected_year}',
        labels={"bins": "Green Revenue Share (%)"},
        category_orders={"bins": sorted(filtered_df["bins"].unique())}
    )
    fig.update_xaxes(type='category')  # Treat bins as categorical for cleaner labels
    fig.show()

# Interactive widget to select year and display the plot
interact(plot_histogram, selected_year=df_plot['year'].unique())
