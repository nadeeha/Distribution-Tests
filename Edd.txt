import pandas as pd
import plotly.express as px

# Ensure df has relevant columns and drop missing
df_filtered = df.dropna(subset=["gics_sector_name", "weight", "ETF-Index Name"]).copy()

# Unique ETF list
etfs = df_filtered["ETF-Index Name"].dropna().unique().tolist()
etfs.insert(0, "All ETFs")

# Create box plot with all ETFs
fig = px.box(
    df_filtered,
    x="gics_sector_name",
    y="weight",
    color="ETF-Index Name",
    points="outliers",  # âœ… only show outliers
    title="Weight Distribution by GICS Sector Across ETFs"
)

# Create dropdown buttons
dropdown_buttons = []

# Button for "All ETFs"
dropdown_buttons.append(dict(
    label="All ETFs",
    method="update",
    args=[{"visible": [True] * len(fig.data)}]
))

# Buttons for individual ETFs
for etf in etfs[1:]:
    visibility = [(trace.name == etf) for trace in fig.data]
    dropdown_buttons.append(dict(
        label=etf,
        method="update",
        args=[{"visible": visibility}]
    ))

# Add dropdown menu to layout
fig.update_layout(
    updatemenus=[{
        "buttons": dropdown_buttons,
        "direction": "down",
        "showactive": True,
        "x": 0.5,
        "xanchor": "center",
        "y": 1.15,
        "yanchor": "top"
    }],
    xaxis_title="GICS Sector",
    yaxis_title="Weight",
    height=700
)

# Show plot
fig.show()
