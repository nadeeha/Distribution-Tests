# Country exposure (use full df, but deduplicate ISIN-level)
df_etf_country = df[df["ETF-Index Name"] == etf].copy()
df_etf_country['exposure'] = (df_etf_country['weight'] * df_etf_country['l6_revenue_pct']) / 100
country_exposure = df_etf_country.groupby('am_country_of_risk_code')['exposure'].sum().reset_index()

fig_country = px.bar(
    country_exposure,
    x='am_country_of_risk_code',
    y='exposure',
    title="Country of Risk Exposure",
    labels={'am_country_of_risk_code': 'Country Code', 'exposure': 'Exposure (%)'},
    color='am_country_of_risk_code'
)

section_html += pio.to_html(fig_country, include_plotlyjs=False, full_html=False)
